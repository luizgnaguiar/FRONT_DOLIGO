(FRONT)Especificação de Engenharia
Front-end ERP/CRM (Doligo) — Arquitetura de Produção
Versão
v1.0 – baseline arquitetural do front-end

1. Objetivo Arquitetural
Definir uma arquitetura de front-end estável, escalável e auditável, capaz de:
* Consumir uma API Go Clean Architecture, stateless, JWT-based
* Suportar ERP/CRM operacional, com fluxos longos e assíncronos
* Evitar lock-in tecnológico
* Facilitar crescimento incremental por domínio (Invoice, BOM, Stock, CRM)
O front-end é consumidor puro de API. Nenhuma regra de negócio crítica reside no cliente.

2. Stack Técnica (Obrigatória)
Camada	Decisão
Linguagem	TypeScript (strict)
Framework	React
Build	Vite (CSR)
Runtime	Node 20+
Navegadores	Evergreen
Estado servidor	TanStack Query
Forms	React Hook Form
Validação	Zod
HTTP	Client único (Axios ou Fetch wrapper)
Proibido
* SSR
* Frameworks full-stack (Next, Remix)
* State managers globais desnecessários
* Lógica de negócio duplicada do backend

3. Arquitetura de Pastas (Contratual)
/src
 ├── app/                # bootstrap, router, guards
 ├── modules/            # domínios de negócio
 │    ├── invoice/
 │    ├── bom/
 │    ├── stock/
 │    └── crm/
 ├── api/                # client HTTP, DTOs, mappers
 ├── state/              # queries, cache, stores globais
 ├── shared/             # UI, hooks, utils, validators
 ├── styles/             # tema, tokens, estilos globais
 ├── assets/             # ícones, logos, estáticos
Princípios
* Modules = domínios, não páginas
* shared não conhece modules
* api não conhece React
* state nunca contém lógica de UI

4. Contratos e Tipagem
DTOs
* Todo DTO do backend deve existir no front
* Campos, tipos e semântica idênticos
* Versionamento coordenado com backend
Validação
* Zod obrigatório
* Zod reflete as regras do backend (não inventa novas)
* Nenhuma chamada à API ocorre sem validação prévia
Erros
* Mapeamento central: ErrorCode → UIMessage
* 
* Nenhum handler faz parsing manual de erro HTTP

5. Camada de API
Client HTTP
* Instância única
* Responsável por:
    * JWT
    * refresh / logout
    * retry
    * timeout
    * cancelamento
Interceptors
* Authorization: Bearer <JWT>
* 401 → logout global
* 403 → fallback de permissão
* 429 → retry com backoff
* 5xx → retry limitado
Timeout
* Global
* Implementado com AbortController
* Exposto para polling e jobs longos

6. Fluxo de Dados e Estado
TanStack Query (Obrigatório)
* Cache por endpoint
* Invalidação por tags/domínios
* Retry automático (429 / 5xx)
* Backoff progressivo
Polling
* Usado para:
    * status de PDF
    * jobs assíncronos
* Intervalo configurável
* Cancelável via AbortController
Estado Global
Permitido apenas para:
* sessão
* preferências globais
* feature flags
Todo resto → estado local ou query cache.

7. UI e Forms
Forms
* React Hook Form
* Zod resolver
* Submit bloqueado se inválido
* Erros de API mapeados para campos
Tabelas
* Virtualização obrigatória para grandes volumes
* Scroll fluido como critério de aceite
* Paginação server-driven
Layout
* Responsivo
* Acessível (keyboard + screen reader)
* Tokens de:
    * cor
    * tipografia
    * espaçamento

8. Segurança e Sessão
JWT
* Stateless
* Storage definido por política do projeto:
    * memory preferencial
    * localStorage apenas se necessário
RBAC
* Baseado em claims do token
* Avaliado no front apenas para UX
* Backend é autoridade final
Rotas
* Guards obrigatórios
* Nenhuma rota privada renderiza sem sessão válida

9. Performance e UX
* Code splitting por rota
* Lazy loading de módulos pesados
* Skeletons padronizados
* Suspense controlado
* Virtualização para listas grandes

10. Observabilidade
Logger
* Estruturado
* Correlation ID propagado da API
Erros
* Error Boundary global
* Fallback visual consistente
Monitoramento
* Integração opcional com Sentry ou equivalente
* Nunca obrigatório para build

11. Testes e Qualidade
Obrigatórios
* Lint + formatter padronizados
* Testes unitários:
    * utils
    * validators
* Testes de componentes críticos
* E2E:
    * Login
    * Invoice
    * Stock
Proibido
* Testar implementação interna da API
* Mock excessivo de TanStack Query

12. Critérios de Aceite (Contratuais)
* FA-01: Build de produção gera bundle funcional sem erros TS
* FA-02: Toda chamada passa pelo client HTTP central
* FA-03: Zod rejeita inputs inválidos antes da API
* FA-04: Rotas privadas bloqueadas sem JWT
* FA-05: Polling de PDF cancelável via AbortController
* FA-06: Tabelas grandes mantêm scroll fluido

13. Decisão Arquitetural Final
SPA (CSR) com React + Vite é a arquitetura correta para o produto Doligo.
Motivos:
* ERP autenticado
* API madura
* Estado server-driven
* Menor custo cognitivo
* Evolução segura

Se quiser, o próximo passo natural seria:
* definir contratos de API por domínio (Invoice/BOM/Stock)
* ou especificar o fluxo completo de Invoice + PDF no front
* ou criar o checklist de bootstrap do repositório
Você escolhe o próximo nível.
